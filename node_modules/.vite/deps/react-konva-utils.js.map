{
  "version": 3,
  "sources": ["../../use-image/index.js", "../../react-konva-utils/es/html.js", "../../react-konva-utils/es/portal.js", "../../react-konva-utils/es/use-image.js"],
  "sourcesContent": ["var React = require('react');\n\nmodule.exports = function useImage(url, crossOrigin, referrerpolicy) {\n  // lets use refs for image and status\n  // so we can update them during render\n  // to have instant update in status/image when new data comes in\n  const statusRef = React.useRef('loading');\n  const imageRef = React.useRef();\n\n  // we are not going to use token\n  // but we need to just to trigger state update\n  const [_, setStateToken] = React.useState(0);\n\n  // keep track of old props to trigger changes\n  const oldUrl = React.useRef();\n  const oldCrossOrigin = React.useRef();\n  const oldReferrerPolicy = React.useRef();\n  if (\n    oldUrl.current !== url ||\n    oldCrossOrigin.current !== crossOrigin ||\n    oldReferrerPolicy.current !== referrerpolicy\n  ) {\n    statusRef.current = 'loading';\n    imageRef.current = undefined;\n    oldUrl.current = url;\n    oldCrossOrigin.current = crossOrigin;\n    oldReferrerPolicy.current = referrerpolicy;\n  }\n\n  React.useLayoutEffect(\n    function () {\n      if (!url) return;\n      var img = document.createElement('img');\n\n      function onload() {\n        img\n          // in Polotno app I found a case when loaded image was not rendered correctly at the first attempt\n          // I found that decoding it manually fixes the issue\n          // also it may be good idea decode it that way, so the work is done in the background\n          // and we don't block the main thread\n          // in context of canvas rendering, large images is a common case\n          .decode()\n          // catch and ignore decode errors because decode may fail but still will render just fine with drawImage on canvas.\n          // I got that case with very large image and chrome\n          .catch(() => {\n            // Intentionally ignore decode errors - image can still render fine on canvas\n          })\n          .finally(() => {\n            statusRef.current = 'loaded';\n            imageRef.current = img;\n            setStateToken(Math.random());\n          });\n      }\n\n      function onerror() {\n        statusRef.current = 'failed';\n        imageRef.current = undefined;\n        setStateToken(Math.random());\n      }\n\n      img.addEventListener('load', onload);\n      img.addEventListener('error', onerror);\n      crossOrigin && (img.crossOrigin = crossOrigin);\n      referrerpolicy && (img.referrerPolicy = referrerpolicy);\n      img.src = url;\n\n      return function cleanup() {\n        img.removeEventListener('load', onload);\n        img.removeEventListener('error', onerror);\n      };\n    },\n    [url, crossOrigin, referrerpolicy]\n  );\n\n  // return array because it is better to use in case of several useImage hooks\n  // const [background, backgroundStatus] = useImage(url1);\n  // const [patter] = useImage(url2);\n  return [imageRef.current, statusRef.current];\n};\n", "var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { Group } from 'react-konva';\nimport { useContextBridge } from 'react-konva';\nimport { flushSync } from 'react-dom';\nconst needForceStyle = (el) => {\n    const pos = window.getComputedStyle(el).position;\n    const ok = pos === 'absolute' || pos === 'relative';\n    return !ok;\n};\nexport function useEvent(fn = () => { }) {\n    const ref = React.useRef(fn);\n    ref.current = fn;\n    return React.useCallback((...args) => {\n        return ref.current.apply(null, args);\n    }, []);\n}\nexport const Html = ({ children, groupProps, divProps, transform, transformFunc, parentNodeFunc, }) => {\n    const Bridge = useContextBridge();\n    const groupRef = React.useRef(null);\n    const [div] = React.useState(() => document.createElement('div'));\n    const root = React.useMemo(() => ReactDOM.createRoot(div), [div]);\n    const shouldTransform = transform !== null && transform !== void 0 ? transform : true;\n    const handleTransform = useEvent(() => {\n        if (shouldTransform && groupRef.current) {\n            const tr = groupRef.current.getAbsoluteTransform();\n            let attrs = tr.decompose();\n            if (transformFunc) {\n                attrs = transformFunc(attrs);\n            }\n            div.style.position = 'absolute';\n            div.style.zIndex = '10';\n            div.style.top = '0px';\n            div.style.left = '0px';\n            div.style.transform = `translate(${attrs.x}px, ${attrs.y}px) rotate(${attrs.rotation}deg) scaleX(${attrs.scaleX}) scaleY(${attrs.scaleY})`;\n            div.style.transformOrigin = 'top left';\n        }\n        else {\n            div.style.position = '';\n            div.style.zIndex = '';\n            div.style.top = '';\n            div.style.left = '';\n            div.style.transform = ``;\n            div.style.transformOrigin = '';\n        }\n        const _a = divProps || {}, { style } = _a, restProps = __rest(_a, [\"style\"]);\n        Object.assign(div.style, style);\n        Object.assign(div, restProps);\n    });\n    React.useLayoutEffect(() => {\n        var _a;\n        const group = groupRef.current;\n        if (!group) {\n            return;\n        }\n        const parent = parentNodeFunc\n            ? parentNodeFunc({ stage: group.getStage() })\n            : (_a = group.getStage()) === null || _a === void 0 ? void 0 : _a.container();\n        if (!parent) {\n            return;\n        }\n        parent.appendChild(div);\n        if (shouldTransform && needForceStyle(parent)) {\n            parent.style.position = 'relative';\n        }\n        group.on('absoluteTransformChange', handleTransform);\n        handleTransform();\n        return () => {\n            var _a;\n            group.off('absoluteTransformChange', handleTransform);\n            (_a = div.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(div);\n        };\n    }, [shouldTransform, parentNodeFunc]);\n    React.useLayoutEffect(() => {\n        handleTransform();\n    }, [divProps, transformFunc]);\n    React.useLayoutEffect(() => {\n        queueMicrotask(() => {\n            flushSync(() => {\n                root.render(React.createElement(Bridge, null, children));\n            });\n        });\n    });\n    React.useLayoutEffect(() => {\n        return () => {\n            setTimeout(() => {\n                root.unmount();\n            });\n        };\n    }, []);\n    return React.createElement(Group, Object.assign({ ref: groupRef }, groupProps));\n};\n", "import React from 'react';\nimport { Group } from 'react-konva';\nexport const Portal = ({ selector, enabled, children }) => {\n    const outer = React.useRef(null);\n    const inner = React.useRef(null);\n    const safeRef = React.useRef(null);\n    const shouldMove = enabled !== null && enabled !== void 0 ? enabled : true;\n    React.useLayoutEffect(() => {\n        if (!outer.current || !inner.current) {\n            return;\n        }\n        safeRef.current = inner.current;\n        const stage = outer.current.getStage();\n        const newContainer = stage.findOne(selector);\n        if (shouldMove && newContainer) {\n            inner.current.moveTo(newContainer);\n        }\n        else {\n            inner.current.moveTo(outer.current);\n        }\n        const outerLayer = outer.current.getLayer();\n        if (!outerLayer)\n            return;\n        outerLayer.batchDraw();\n        if (newContainer) {\n            const newContainerLayer = newContainer.getLayer();\n            if (!newContainerLayer)\n                return;\n            newContainerLayer.batchDraw();\n        }\n    }, [selector, shouldMove]);\n    React.useEffect(() => {\n        return () => {\n            var _a;\n            (_a = safeRef.current) === null || _a === void 0 ? void 0 : _a.destroy();\n        };\n    }, []);\n    return (React.createElement(Group, { name: \"_outer_portal\", ref: outer },\n        React.createElement(Group, { name: \"_inner_portal\", ref: inner }, children)));\n};\n", "export { default as useImage } from 'use-image';\n"],
  "mappings": "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",
  "names": ["React", "React", "ReactDOM", "_a", "import_react", "React"]
}
